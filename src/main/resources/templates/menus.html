<!doctype html>
<html dir="ltr" lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>Christmas diner</title>
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/menus.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script>
        let visCount = 0;
        let quantity = 3;
        let i = 0;
        let u='vmax'
        let listImg ;
        let listData;
        let sizeN=25;
        let lastPos=0;
        function loadImg(img) {
            $(img).animate({
                left: '50%',
                top: lastPos + u,
                queue: false
            }, 1000).hide().fadeIn({queue: false}, 2500);

            lastPos+=sizeN;
        }

        function loadData(data) {
            $(data).animate({
                right: '50%',
                top: lastPos + u,
                queue: false
            }, 1000).hide().fadeIn({queue: false}, 3500);
            lastPos+=sizeN;
            visCount++;
        }

        function hideElements(list, start, end) {
            for (let j = start; j <= end; j++) {
                $(list[j]).hide();
            }
        }


        function loadMeals() {




            hideElements(listImg, quantity, listImg.length);
            hideElements(listData, quantity, listData.length);
            for (let j = 0; j <= quantity; j++) {
                loadImg(listImg[j]);
            }
            lastPos=sizeN;
            for (let j = 0; j <= quantity; j++) {
                loadData(listData[j]);
            }

        }

        function WidthChange(mq) {
            if (mq.matches) {
               u='vmax';
                sizeN=30
                loadMeals();

            } else {
               u='vmin';
                sizeN=25
                loadMeals();
            }
        }


        $(document).ready(function () {
            lastPos=sizeN
            listImg= document.querySelectorAll("#img-list");
            listData= document.querySelectorAll("#data-list");
            if (matchMedia) {
                let mq = window.matchMedia("(max-width: 600px)");
                mq.addListener(WidthChange);
                WidthChange(mq);
            }
        });
        let lastPosition = 0;
        let sumDown = 0;
        let lastAdd=0;
        window.addEventListener('scroll', () => {
            let element = document.querySelector("#data-list");
            let pos = document.body.getBoundingClientRect().top;
            if (pos < lastPosition) {
                lastAdd=lastPosition - pos;
                sumDown += lastAdd;
                if ($(element).offset().top * 2 / 3 <= sumDown) {
                    sumDown = 0;
                    console.log("new element")
                    if(visCount>=listImg.length){
                        console.log("No more meals to show")
                    }else{
                        loadImg(listImg[visCount]);
                        lastPos-=sizeN
                        loadData(listData[visCount]);
                    }

                }
            } else {
                sumDown=0;
                    sumDown-=-Math.abs(lastAdd);

            }
            lastPosition = document.body.getBoundingClientRect().top;
        });
    </script>

</head>
<body>
<header style="z-index: 98">
    <nav class="navbar navbar-expand-lg bg-light " style="z-index: 98">
        <div class="container-fluid ">

            <button aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"
                    class="navbar-toggler" data-bs-target="#navbarSupportedContent"
                    data-bs-toggle="collapse" type="button">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-center " id="navbarSupportedContent">
                <ul class=" navbar-nav ">
                    <li class="nav-item">
                        <a aria-current="page" class="nav-link active  mx-3 fs-4" href="index" style="cursor: pointer;">Home</a>
                    </li>
                    <li class="nav-item">
                        <a aria-current="page" class="nav-link active mx-3 fs-4" href="menus" style="cursor: pointer;">Menus</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>


<div class="grid ">
    <div class="row text-center" id="popup">
        <div class="col">
            <h4 class=" display-6" style="font-size: 2rem">Christmas Day menu</h4>
            <h5 class="display-6" style="font-size: 1.5rem">Christmas morning</h5>
        </div>
    </div>


    <div class="row text-center" th:each="meal:${meals}">

        <img alt="qka snimka" class="col img" id="img-list" style="width:30vmin; height:25vmin" th:src="${meal.photo}">

        <div class="col ">
            <div class="text" id="data-list">
                <h5 th:text="${meal.name}">Crunchy granola with berries & cherries</h5>
                <div>
                    <span th:text="${meal.timeNeeded}"></span> minutes
                </div>
                <div>
                    <span th:text="${meal.calories}"></span> calories
                </div>
                <div>
                    <a th:href="${meal.recipe}">recipe</a>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="https://unpkg.com/magic-snowflakes/dist/snowflakes.min.js"></script>
<script>
    new Snowflakes({
        minSize: 10,
        maxSize: 100,
        color: '#A0E3F6',
        wind: true
    });
</script>
<script crossorigin="anonymous"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>